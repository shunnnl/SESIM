
# ğŸš€ SESIM í”„ë¡œì íŠ¸ í¬íŒ… ë©”ë‰´ì–¼

ì´ ë¬¸ì„œëŠ” **SESIM í”Œë«í¼ì˜ í”„ë¡ íŠ¸ì—”ë“œ ë° ë°±ì—”ë“œ ì„œë¹„ìŠ¤**ë¥¼ ìƒˆë¡œìš´ í™˜ê²½ì— ë°°í¬/í¬íŒ…í•˜ê¸° ìœ„í•œ **ì „ì²´ ì ˆì°¨**ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤. AWS EC2, Docker, Jenkins, ALB ë“± ì£¼ìš” ì¸í”„ë¼ í™˜ê²½ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
SESIM/
â”œâ”€â”€ fe/sesim               # í”„ë¡ íŠ¸ì—”ë“œ (React)
â””â”€â”€ be/sesim               # ë°±ì—”ë“œ (Spring Boot)
```

---

# ğŸ§± í”„ë¡ íŠ¸ì—”ë“œ í¬íŒ… ë©”ë‰´ì–¼

## 1. Docker ì´ë¯¸ì§€ ë¹Œë“œ

### Dockerfile ì˜ˆì‹œ (fe/sesim ë‚´ë¶€ì— ìƒì„±)

```dockerfile
FROM node:18 as builder
WORKDIR /app
COPY . .
RUN npm install
RUN npm run build
```

## 2. EC2ì— ì—…ë¡œë“œ ë° ì ‘ì†

```bash
scp -i [KEY].pem -r ./fe/sesim ubuntu@[EC2_IP]:/home/ubuntu/
ssh -i [KEY].pem ubuntu@[EC2_IP]
cd /home/ubuntu/sesim
```

## 3. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ë¹Œë“œ ê²°ê³¼ë¬¼ í™•ì¸

```bash
docker build -t react-builder .
docker run -it --rm react-builder sh
# ls /app/build
```

## 4. Nginx ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (ì •ì  ì„œë¹„ìŠ¤)

```bash
sudo docker run --name nginx-react \
  -p 80:80 \
  -v /home/ubuntu/sesim/dist:/usr/share/nginx/html:ro \
  -d nginx
```

> Nginxì—ì„œ build ê²½ë¡œê°€ ì˜ëª»ë˜ë©´ `docker stop && docker rm`ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì¬ì‹¤í–‰ í•„ìš”

---

# âš™ï¸ í”„ë¡ íŠ¸ Jenkins ìë™ ë°°í¬ ë©”ë‰´ì–¼

## Jenkins íŒŒì´í”„ë¼ì¸ í•µì‹¬ ìš”ì•½

* ë¹Œë“œ ê²½ë¡œ: `fe/sesim`
* ì„œë²„: `43.201.252.136`, `13.124.60.56`
* dist íŒŒì¼ì„ ê° ì„œë²„ì— ë°°í¬

### ì£¼ìš” ë‹¨ê³„

1. `git clone` â†’ `npm install` â†’ `npm run build`
2. `scp` ëª…ë ¹ì–´ë¡œ ê° ì„œë²„ì˜ `/home/ubuntu/sesim/dist`ì— ë°°í¬
3. Mattermostì— ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ ì „ì†¡

---

# ğŸ›  ë°±ì—”ë“œ í¬íŒ… ë©”ë‰´ì–¼

## 1. EC2 ì´ˆê¸° í™˜ê²½ ì„¤ì •

```bash
sudo apt update
sudo apt install docker.io openjdk-17-jdk -y
java -version
docker -v
```

## 2. MySQL Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
sudo docker run -d --name mysql-container \
  -e MYSQL_ROOT_PASSWORD=[ë¹„ë°€ë²ˆí˜¸] \
  -e MYSQL_DATABASE=sesim \
  -e MYSQL_USER=sesim \
  -e MYSQL_PASSWORD=[ë¹„ë°€ë²ˆí˜¸] \
  -p 6033:3306 \
  --restart always \
  mysql:8.0.36
```

## 3. Spring Boot ë¹Œë“œ & ì—…ë¡œë“œ

```bash
./gradlew build -x test
scp -i [KEY].pem -r ./be/sesim ubuntu@[EC2_IP]:/home/ubuntu/
```

## 4. Dockerfile ì˜ˆì‹œ (be/sesim ë‚´ë¶€)

```dockerfile
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY build/libs/sesim-0.0.1-SNAPSHOT.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
```

## 5. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰

```bash
sudo docker build -t sesim/springboot-app .

sudo docker run -d --name sesim-backend-container -p 8080:8080 \
  -e DB_URL=jdbc:mysql://[DB_HOST]:6033/sesim \
  -e DB_USERNAME=sesim \
  -e DB_PASSWORD=[ë¹„ë°€ë²ˆí˜¸] \
  -e JWT_SECRET=... \
  ... (ê¸°íƒ€ í™˜ê²½ë³€ìˆ˜) \
  --restart always \
  sesim/springboot-app
```

---

# âš™ï¸ ë°±ì—”ë“œ Jenkins ìë™ ë°°í¬ ë©”ë‰´ì–¼

## Jenkins íŒŒì´í”„ë¼ì¸ ìš”ì•½

* ë¸Œëœì¹˜: `be`
* ì´ë¯¸ì§€ ë¹Œë“œ í›„ `.tar`ë¡œ export
* ë‘ ì„œë²„ë¡œ ì „ì†¡ â†’ ì»¨í…Œì´ë„ˆ ì •ì§€ â†’ ì´ë¯¸ì§€ ë¡œë“œ í›„ ì‹¤í–‰
* ê° ì„œë²„ì— ë‹¤ë¥¸ SSH í‚¤ ì‚¬ìš©

### ì£¼ìš” ë‹¨ê³„

1. `./gradlew build -x test`
2. `docker build` + `docker save`
3. ê° ì„œë²„ì— `scp` í›„ `docker load`
4. `docker run`ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ í¬í•¨í•˜ì—¬ ì‹¤í–‰
5. Mattermostë¡œ ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ ì „ì†¡

---

# ğŸŒ ALB ì„¤ì • ë©”ë‰´ì–¼

## 1. Target Group ìƒì„±

* ìœ í˜•: `Instance`
* í”„ë¡œí† ì½œ/í¬íŠ¸: `HTTP / 80`
* í—¬ìŠ¤ ì²´í¬ ê²½ë¡œ: `/`
* ëŒ€ìƒ EC2 ë“±ë¡

## 2. Application Load Balancer ìƒì„±

* ë¦¬ìŠ¤ë„ˆ: HTTP 80
* ê°€ìš© ì˜ì—­: EC2ê°€ ìœ„ì¹˜í•œ AZ
* ë³´ì•ˆ ê·¸ë£¹: í¬íŠ¸ 80 í—ˆìš©
* Target Group ì—°ê²°

**ALB ì£¼ì†Œ ì˜ˆì‹œ**:
[http://sesim-front-alb-35113181.ap-northeast-2.elb.amazonaws.com](http://sesim-front-alb-35113181.ap-northeast-2.elb.amazonaws.com)

## 3. ALB í—¬ìŠ¤ ì²´í¬ ë° ì¥ì•  í…ŒìŠ¤íŠ¸

* `/` ê²½ë¡œì—ì„œ 200 OK ë°˜í™˜ í•„ìš”
* ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì‹œ `Unhealthy` ë°˜ì‘ í™•ì¸

```bash
ssh -i [KEY].pem ubuntu@[EC2_IP]
sudo docker stop nginx-react
sudo docker restart nginx-react
```

---
